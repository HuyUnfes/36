--[[ 
    JOB ID JOINER - DUAL MODE (SINGLE & SPAM)
    Created by Request
]]

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local VirtualUser = game:GetService("VirtualUser")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

--------------------------------------------------------------------------------
-- 1. ANTI-AFK
--------------------------------------------------------------------------------
local function activateAntiAfk()
    LocalPlayer.Idled:Connect(function()
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end)
end
activateAntiAfk()

--------------------------------------------------------------------------------
-- 2. HÀM LỌC ID (CLEAN TEXT)
--------------------------------------------------------------------------------
local function extractJobId(text)
    if not text then return nil end
    -- Pattern chuẩn UUID: 8-4-4-4-12
    local pattern = "%x%x%x%x%x%x%x%x%-%x%x%x%x%-%x%x%x%x%-%x%x%x%x%-%x%x%x%x%x%x%x%x%x%x%x%x"
    return string.match(text, pattern)
end

--------------------------------------------------------------------------------
-- 3. GIAO DIỆN UI
--------------------------------------------------------------------------------
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local CloseButton = Instance.new("TextButton")
local InputBox = Instance.new("TextBox")
local StatusLabel = Instance.new("TextLabel")
local BtnJoinOnce = Instance.new("TextButton") -- Nút Join thường
local BtnSpamJoin = Instance.new("TextButton") -- Nút Spam

-- Parent UI
if syn and syn.protect_gui then syn.protect_gui(ScreenGui) ScreenGui.Parent = CoreGui
elseif gethui then ScreenGui.Parent = gethui()
else ScreenGui.Parent = CoreGui end

-- Main Frame
MainFrame.Name = "JobIdDual"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
MainFrame.Size = UDim2.new(0, 300, 0, 200)
MainFrame.Active = true
MainFrame.Draggable = true

-- Title
Title.Parent = MainFrame
Title.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Font = Enum.Font.GothamBold
Title.Text = "  Job ID Joiner"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.TextSize = 14

-- Close Button
CloseButton.Parent = Title
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.Position = UDim2.new(1, -30, 0, 0)
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)

-- Input Box
InputBox.Parent = MainFrame
InputBox.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
InputBox.BorderSizePixel = 0
InputBox.Position = UDim2.new(0.05, 0, 0.2, 0)
InputBox.Size = UDim2.new(0.9, 0, 0.25, 0)
InputBox.Font = Enum.Font.Code
InputBox.PlaceholderText = "Paste text Discord... (tự lọc rác)"
InputBox.Text = ""
InputBox.TextColor3 = Color3.fromRGB(200, 200, 200)
InputBox.TextSize = 12
InputBox.TextWrapped = true
InputBox.ClearTextOnFocus = false

-- Status Label
StatusLabel.Parent = MainFrame
StatusLabel.BackgroundTransparency = 1
StatusLabel.Position = UDim2.new(0, 0, 0.45, 0)
StatusLabel.Size = UDim2.new(1, 0, 0.15, 0)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Text = "Waiting..."
StatusLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
StatusLabel.TextSize = 12

--------------------------------------------------------------------------------
-- 4. SETUP 2 NÚT BẤM
--------------------------------------------------------------------------------

-- >> NÚT 1: JOIN 1 LẦN (Màu Xanh Lá)
BtnJoinOnce.Parent = MainFrame
BtnJoinOnce.BackgroundColor3 = Color3.fromRGB(46, 204, 113)
BtnJoinOnce.Position = UDim2.new(0.05, 0, 0.65, 0)
BtnJoinOnce.Size = UDim2.new(0.42, 0, 0.25, 0)
BtnJoinOnce.Font = Enum.Font.GothamBold
BtnJoinOnce.Text = "JOIN (1 Lần)"
BtnJoinOnce.TextColor3 = Color3.fromRGB(255, 255, 255)
BtnJoinOnce.TextSize = 12

-- >> NÚT 2: SPAM JOIN (Màu Cam)
BtnSpamJoin.Parent = MainFrame
BtnSpamJoin.BackgroundColor3 = Color3.fromRGB(230, 126, 34)
BtnSpamJoin.Position = UDim2.new(0.53, 0, 0.65, 0)
BtnSpamJoin.Size = UDim2.new(0.42, 0, 0.25, 0)
BtnSpamJoin.Font = Enum.Font.GothamBold
BtnSpamJoin.Text = "SPAM JOIN (Treo)"
BtnSpamJoin.TextColor3 = Color3.fromRGB(255, 255, 255)
BtnSpamJoin.TextSize = 12

--------------------------------------------------------------------------------
-- 5. LOGIC XỬ LÝ
--------------------------------------------------------------------------------

-- Biến kiểm soát spam
local isSpamming = false

-- Logic nút JOIN 1 LẦN
BtnJoinOnce.MouseButton1Click:Connect(function()
    -- Tắt spam nếu đang chạy
    isSpamming = false 
    BtnSpamJoin.Text = "SPAM JOIN (Treo)"
    BtnSpamJoin.BackgroundColor3 = Color3.fromRGB(230, 126, 34)

    local id = extractJobId(InputBox.Text)
    if id then
        InputBox.Text = id -- Hiện ID sạch
        StatusLabel.Text = "Đang thử join..."
        StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
        
        -- Thử Teleport 1 lần
        TeleportService:TeleportToPlaceInstance(game.PlaceId, id, LocalPlayer)
    else
        StatusLabel.Text = "Lỗi: Không tìm thấy ID!"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
    end
end)

-- Logic nút SPAM JOIN
BtnSpamJoin.MouseButton1Click:Connect(function()
    -- Chế độ Toggle (Bấm để Bật/Tắt)
    if isSpamming then
        -- Đang chạy thì tắt đi
        isSpamming = false
        BtnSpamJoin.Text = "SPAM JOIN (Treo)"
        BtnSpamJoin.BackgroundColor3 = Color3.fromRGB(230, 126, 34) -- Màu cam
        StatusLabel.Text = "Đã dừng spam."
        StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    else
        -- Chưa chạy thì bật lên
        local id = extractJobId(InputBox.Text)
        if not id then
            StatusLabel.Text = "Lỗi: Không tìm thấy ID!"
            StatusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
            return
        end

        InputBox.Text = id -- Hiện ID sạch
        isSpamming = true
        BtnSpamJoin.Text = "DỪNG SPAM"
        BtnSpamJoin.BackgroundColor3 = Color3.fromRGB(192, 57, 43) -- Màu đỏ
        StatusLabel.Text = "Đang Spam Join (1s)..."
        StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)

        -- Vòng lặp Spam
        task.spawn(function()
            while isSpamming do
                if id == game.JobId then
                    StatusLabel.Text = "Thành công!"
                    isSpamming = false
                    break
                end

                pcall(function()
                    TeleportService:TeleportToPlaceInstance(game.PlaceId, id, LocalPlayer)
                end)
                
                task.wait(1) -- Delay 1 giây
            end
        end)
    end
end)
