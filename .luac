--[[ 
    ADVANCED JOB ID JOINER & ANTI-AFK
    Created for request: Join Job ID, Clean Text, Spam Join 1s, Anti-AFK
]]

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local VirtualUser = game:GetService("VirtualUser")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

--------------------------------------------------------------------------------
-- 1. ANTI-AFK SYSTEM
--------------------------------------------------------------------------------
local function activateAntiAfk()
    LocalPlayer.Idled:Connect(function()
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
        print("Anti-AFK: Prevented disconnection.")
    end)
    print("Anti-AFK đã được kích hoạt.")
end
activateAntiAfk()

--------------------------------------------------------------------------------
-- 2. HÀM XỬ LÝ CHUỖI (CLEAN TEXT)
--------------------------------------------------------------------------------
-- Hàm này sử dụng Pattern Matching để tìm đúng định dạng Job ID (UUID)
-- Định dạng: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
local function extractJobId(text)
    if not text then return nil end
    -- Pattern tìm chuỗi hex có dấu gạch ngang (UUID standard)
    local jobId = string.match(text, "%x+-%x+-%x+-%x+-%x+")
    return jobId
end

--------------------------------------------------------------------------------
-- 3. GIAO DIỆN UI (GUI)
--------------------------------------------------------------------------------
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local InputBox = Instance.new("TextBox")
local JoinButton = Instance.new("TextButton")
local StatusLabel = Instance.new("TextLabel")
local CloseButton = Instance.new("TextButton")

-- Bảo vệ GUI khỏi việc bị reset khi chết
if syn and syn.protect_gui then
    syn.protect_gui(ScreenGui)
    ScreenGui.Parent = CoreGui
elseif gethui then
    ScreenGui.Parent = gethui()
else
    ScreenGui.Parent = CoreGui
end

-- Cấu hình MainFrame
MainFrame.Name = "JobIdJoiner"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
MainFrame.Size = UDim2.new(0, 300, 0, 200)
MainFrame.Active = true
MainFrame.Draggable = true -- Cho phép kéo thả bảng

-- Tiêu đề
Title.Parent = MainFrame
Title.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Font = Enum.Font.GothamBold
Title.Text = "Job ID Joiner (Spam 1s)"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 14

-- Nút đóng
CloseButton.Parent = Title
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.Position = UDim2.new(1, -30, 0, 0)
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Ô nhập liệu (Input)
InputBox.Parent = MainFrame
InputBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
InputBox.BorderSizePixel = 0
InputBox.Position = UDim2.new(0.1, 0, 0.25, 0)
InputBox.Size = UDim2.new(0.8, 0, 0.2, 0)
InputBox.Font = Enum.Font.Gotham
InputBox.PlaceholderText = "Dán Job ID hoặc Text từ Discord vào đây..."
InputBox.Text = ""
InputBox.TextColor3 = Color3.fromRGB(255, 255, 255)
InputBox.TextSize = 12
InputBox.TextWrapped = true
InputBox.ClearTextOnFocus = false

-- Nhãn trạng thái
StatusLabel.Parent = MainFrame
StatusLabel.BackgroundTransparency = 1
StatusLabel.Position = UDim2.new(0, 0, 0.5, 0)
StatusLabel.Size = UDim2.new(1, 0, 0.15, 0)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Text = "Waiting..."
StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLabel.TextSize = 12

-- Nút Join
JoinButton.Parent = MainFrame
JoinButton.BackgroundColor3 = Color3.fromRGB(0, 170, 127)
JoinButton.BorderSizePixel = 0
JoinButton.Position = UDim2.new(0.2, 0, 0.7, 0)
JoinButton.Size = UDim2.new(0.6, 0, 0.2, 0)
JoinButton.Font = Enum.Font.GothamBold
JoinButton.Text = "JOIN SERVER (SPAM)"
JoinButton.TextColor3 = Color3.fromRGB(255, 255, 255)
JoinButton.TextSize = 14

--------------------------------------------------------------------------------
-- 4. LOGIC XỬ LÝ JOIN
--------------------------------------------------------------------------------
local isJoining = false

JoinButton.MouseButton1Click:Connect(function()
    local rawText = InputBox.Text
    local cleanID = extractJobId(rawText)

    if not cleanID then
        StatusLabel.Text = "Lỗi: Không tìm thấy Job ID hợp lệ!"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
        return
    end

    if isJoining then return end -- Ngăn bấm nhiều lần tạo nhiều luồng spam
    isJoining = true
    
    StatusLabel.Text = "Đang spam join ID: " .. cleanID:sub(1,8) .. "..."
    StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
    
    -- Vòng lặp Spam Join (1 giây 1 lần)
    task.spawn(function()
        while isJoining do
            -- Kiểm tra xem ID có khác với server hiện tại không để tránh lỗi
            if cleanID == game.JobId then
                StatusLabel.Text = "Bạn đang ở trong server này rồi!"
                isJoining = false
                break
            end

            -- Thực hiện Teleport
            -- Lưu ý: TeleportToPlaceInstance chỉ hoạt động nếu Job ID thuộc về Place ID hiện tại.
            -- Nếu muốn join game khác, cần phải biết PlaceID của game đó. Script này mặc định là game hiện tại.
            local success, err = pcall(function()
                TeleportService:TeleportToPlaceInstance(game.PlaceId, cleanID, LocalPlayer)
            end)

            if success then
                StatusLabel.Text = "Đang kết nối..."
            else
                print("Teleport failed (retrying): " .. tostring(err))
            end
            
            task.wait(1) -- Spam 1s/lần theo yêu cầu
        end
    end)
end)

print("Job ID Script Loaded!")
